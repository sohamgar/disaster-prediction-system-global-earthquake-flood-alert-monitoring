<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Reset Password — Disaster Alert</title>

<!-- BOOTSTRAP -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">

<!-- ICONS -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">

<!-- GOOGLE FONT -->
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">

<style>
body {
    background: linear-gradient(135deg, #0a1729, #122b49, #1c3d67);
    min-height: 100vh;
    display: flex;
    justify-content: center;
    align-items: center;
    font-family: "Poppins", sans-serif;
    padding: 25px;
    overflow: hidden;
    position: relative;
}

/* Floating background */
.bg-shape {
    position: absolute;
    width: 500px;
    height: 500px;
    background: radial-gradient(circle at center, rgba(0,170,255,0.35), transparent);
    border-radius: 50%;
    filter: blur(150px);
    animation: floatBg 10s ease-in-out infinite alternate;
    z-index: 0;
}
@keyframes floatBg {
    from { transform: translate(-150px, -100px); }
    to { transform: translate(150px, 100px); }
}

.card {
    background: rgba(255,255,255,0.10);
    backdrop-filter: blur(18px);
    border-radius: 25px;
    padding: 45px 40px;
    width: 430px;
    color: #fff;
    box-shadow: 0 20px 50px rgba(0,0,0,0.4);
    animation: fadeUp 0.7s ease;
    position: relative;
    z-index: 2;
}
@keyframes fadeUp {
    from { opacity: 0; transform: translateY(35px); }
    to { opacity: 1; transform: translateY(0); }
}

.card h3 {
    text-align: center;
    font-weight: 600;
    font-size: 28px;
    margin-bottom: 18px;
}

.card p.subtext {
    text-align: center;
    color: #d0d7e4;
    font-size: 14px;
    margin-bottom: 30px;
}

/* Flash container fixed */
.flash-container {
    position: fixed;
    top: 20px;
    left: 50%;
    transform: translateX(-50%);
    width: 90%;
    max-width: 450px;
    z-index: 9999;
    pointer-events: none;
    text-align: center;
}

.alert {
    display: inline-block;
    font-size: 14px;
    border-radius: 14px;
    margin-bottom: 10px;
    padding: 10px 15px;
    font-weight: 600;
    box-shadow: 0 4px 15px rgba(0,0,0,0.3);
    pointer-events: auto;
}
.alert-success { background-color: #28a745; color: #fff; border: 1px solid #1f7a34; }
.alert-danger  { background-color: #dc3545; color: #fff; border: 1px solid #a71d2a; }

/* Input container */
.icon-input-wrapper {
    position: relative;
    margin-bottom: 5px;
}
.icon-input-wrapper input {
    width: 100%;
}
.icon-input-wrapper i.input-icon {
    position: absolute;
    left: 18px;
    top: 50%;
    transform: translateY(-50%);
    pointer-events: none;
    color: #bcd2f7;
    font-size: 17px;
}
.icon-input-wrapper i.toggle-pass {
    position: absolute;
    right: 18px;
    top: 50%;
    transform: translateY(-50%);
    cursor: pointer;
    color: #d1d5db;
    font-size: 18px;
}

.status-text {
    font-size: 13px;
    min-height: 18px;
    margin-bottom: 20px;
    padding-left: 3px;
}

.form-control {
    background: rgba(255,255,255,0.16);
    color:#fff;
    border:1px solid rgba(255,255,255,0.25);
    border-radius:14px;
    height:52px;
    padding-left:50px;
    font-size:16px;
    transition:0.3s ease;
}
.form-control:focus {
    background: rgba(255,255,255,0.23);
    border-color: #4dcaff;
    box-shadow: 0 0 10px #4dcaff;
}

.btn-reset {
    width:100%;
    background: linear-gradient(135deg, #14e0ff, #007cff);
    color:#002244;
    border:none;
    border-radius:14px;
    height:52px;
    font-weight:600;
    letter-spacing: .5px;
    transition:0.25s;
    margin-top: 10px;
    cursor: not-allowed;
    opacity: 0.6;
}
.btn-reset.enabled {
    cursor: pointer;
    opacity: 1;
}
.btn-reset:hover.enabled {
    filter: brightness(1.2);
    transform: translateY(-2px);
}

.link-back {
    text-align:center;
    margin-top:18px;
}
.link-back a {
    color: #bcd2f7;
    font-size: 14px;
}
.link-back a:hover { color: #fff; }

</style>
</head>

<body>
<div class="bg-shape"></div>

<div class="flash-container">
  {% with messages = get_flashed_messages(with_categories=true) %}
    {% if messages %}
      {% for category, message in messages %}
        <div class="alert alert-{{ category }}">{{ message }}</div>
      {% endfor %}
    {% endif %}
  {% endwith %}
</div>

<div class="card">
  <h3>Reset Password</h3>
  <p class="subtext">Create a new secure password for your account</p>

  <form method="POST" id="resetForm">

    <div class="icon-input-wrapper">
      <i class="fa fa-lock input-icon"></i>
      <input type="password" name="password" id="password" class="form-control"
             placeholder="New Password" required minlength="6" />
      <i class="fa fa-eye toggle-pass" onclick="togglePassword('password')"></i>
    </div>
    <div id="pass_strength" class="status-text"></div>

    <div class="icon-input-wrapper">
      <i class="fa fa-lock input-icon"></i>
      <input type="password" name="confirm_password" id="confirm_password"
             class="form-control" placeholder="Confirm Password" required minlength="6" />
      <i class="fa fa-eye toggle-pass" onclick="togglePassword('confirm_password')"></i>
    </div>
    <div id="confirm_status" class="status-text"></div>

    <button type="submit" class="btn-reset" id="resetBtn" disabled>Reset Password</button>
  </form>

  <div class="link-back">
    <a href="/login">← Back to Login</a>
  </div>
</div>

<script>
function togglePassword(id) {
    const input = document.getElementById(id);
    input.type = input.type === "password" ? "text" : "password";
}

const pass = document.getElementById("password");
const confirm = document.getElementById("confirm_password");
const resetBtn = document.getElementById("resetBtn");
const passBox = document.getElementById("pass_strength");
const confirmBox = document.getElementById("confirm_status");

function setStatus(el, msg, type){
    el.textContent = msg;
    el.style.color = type === "success" ? "#67ff98" :
                     type === "warning" ? "#ffe38f" :
                     "#ff7b7b";
}

function validateForm(){
    const txt = pass.value;
    let score = 0;
    if(txt.length >= 6) score++;
    if(/[A-Z]/.test(txt)) score++;
    if(/[0-9]/.test(txt)) score++;
    if(/[@$!%*?&]/.test(txt)) score++;

    // Show strength
    if(!txt) passBox.textContent="";
    else if(score <= 1) setStatus(passBox,"Weak","danger");
    else if(score <= 3) setStatus(passBox,"Medium","warning");
    else setStatus(passBox,"Strong","success");

    // Confirm password check
    if(!confirm.value) {
        confirmBox.textContent="";
        resetBtn.disabled=true;
        resetBtn.classList.remove('enabled');
        return;
    }

    // Enable button only if password is Strong (score = 4) AND matches
    if(pass.value === confirm.value && score === 4){
        setStatus(confirmBox,"Passwords match","success");
        resetBtn.disabled = false;
        resetBtn.classList.add('enabled');
    } else {
        if(pass.value !== confirm.value) setStatus(confirmBox,"Passwords do not match","danger");
        resetBtn.disabled = true;
        resetBtn.classList.remove('enabled');
    }
}

pass.addEventListener("input", validateForm);
confirm.addEventListener("input", validateForm);

document.getElementById("resetForm").addEventListener("submit", (e) => {
    if(pass.value !== confirm.value){
        e.preventDefault();
        alert("Passwords do not match!");
    }
});

// Auto-hide flash messages
setTimeout(() => {
    document.querySelectorAll('.flash-container .alert').forEach(el => {
        el.style.transition = "0.5s";
        el.style.opacity = "0";
        setTimeout(() => el.remove(), 600);
    });
}, 3000);
</script>
</body>
</html>
